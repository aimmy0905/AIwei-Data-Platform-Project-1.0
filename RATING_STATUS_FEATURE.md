# 评分状态功能说明

## 功能概述

将绩效管理系统中的"状态"列改为"评分状态"，用于显示项目经理和销售经理对下属员工的评分状态，并提供便捷的评分入口。

## 主要变更

### 1. 状态显示变更
- **原来**: 显示绩效记录的流程状态（草稿、进行中、已完成、已审批）
- **现在**: 显示评分状态（已评分、未评分、不适用）

### 2. 评分状态逻辑
- **已评分**: 当前用户已对该员工进行智能方案考核评分
- **未评分**: 当前用户有权限但尚未对该员工评分
- **不适用**: 当前用户无权限对该员工评分

### 3. 权限控制
根据用户角色确定评分权限：
- **总经理**: 可对所有员工评分
- **销售总监**: 可对销售经理评分
- **销售经理**: 可对销售专员评分
- **项目总监**: 可对项目经理评分
- **项目经理**: 可对运营专员评分

### 4. 评分入口
- 在"评分状态"列中，对于"未评分"的员工，显示"评分"按钮
- 点击按钮打开评分模态框，可进行智能方案考核评分
- 评分完成后，状态自动更新为"已评分"

## 技术实现

### 1. 状态判断函数
```typescript
const getRatingStatus = (record: NewPerformanceRecord) => {
  const canRateThisEmployee = canRateEmployee(record.employee_id)
  if (!canRateThisEmployee) {
    return { status: 'not_applicable', text: '不适用', canRate: false }
  }
  
  const hasCurrentUserRated = record.evaluators?.intelligent === currentUserId
  
  return {
    status: hasCurrentUserRated ? 'rated' : 'not_rated',
    text: hasCurrentUserRated ? '已评分' : '未评分',
    canRate: !hasCurrentUserRated
  }
}
```

### 2. 样式设计
- **已评分**: 绿色渐变背景，表示完成状态
- **未评分**: 橙色渐变背景，表示待处理状态
- **不适用**: 灰色渐变背景，表示无关状态
- **评分按钮**: 蓝色渐变，悬停效果

### 3. 数据更新
评分提交后自动更新：
- 智能方案评分记录
- 评分人标记（evaluators.intelligent）
- 重新计算总分
- 更新备注信息

## 使用场景

### 场景1：项目经理评分下属
1. 项目经理登录系统
2. 查看运营专员的绩效记录
3. 看到"未评分"状态和"评分"按钮
4. 点击评分按钮，填写智能方案考核评分
5. 提交后状态变为"已评分"

### 场景2：销售经理评分下属
1. 销售经理登录系统
2. 查看销售专员的绩效记录
3. 对未评分的员工进行评分
4. 系统自动更新评分状态

## 界面展示

### 表格视图
- 表头显示"评分状态"
- 状态列显示彩色标签和评分按钮
- 支持桌面端和移动端响应式布局

### 卡片视图
- 卡片底部显示评分状态
- 未评分员工显示评分按钮
- 保持卡片布局的美观性

### 详细视图
- 模态框中的表格同样显示评分状态
- 支持批量查看员工的评分状态
- 提供快速评分入口

## 注意事项

1. **权限验证**: 系统会严格验证用户是否有权限对特定员工评分
2. **重复评分**: 已评分的员工不会再显示评分按钮，避免重复评分
3. **数据一致性**: 评分后会自动重新计算相关分数，保持数据一致性
4. **用户体验**: 评分状态一目了然，操作简单直观

## 后续优化建议

1. **评分历史**: 记录评分历史，支持查看评分变更记录
2. **批量评分**: 支持批量选择员工进行评分
3. **评分提醒**: 对未评分的员工发送提醒通知
4. **评分统计**: 提供评分完成率统计和分析
