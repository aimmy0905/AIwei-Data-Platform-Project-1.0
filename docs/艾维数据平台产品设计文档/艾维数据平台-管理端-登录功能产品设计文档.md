# 艾维数据平台-管理端登录功能详细产品设计文档

## 1. 功能概述

### 1.1 功能定位
登录功能是艾维数据平台管理端的入口模块，负责用户身份验证和系统访问控制，确保只有授权用户能够访问平台数据和功能。

### 1.2 设计目标
- 提供安全可靠的用户身份验证机制
- 支持密码找回和重置功能
- 提供良好的用户体验和操作便利性
- 确保系统安全性和数据保护

## 2. 功能模块设计

### 2.1 用户登录模块

#### 2.1.1 登录页面布局
- **页面标题**：艾维数据平台管理端
- **登录表单区域**：居中显示，包含账号输入框、密码输入框和登录按钮
- **辅助功能区域**：忘记密码链接、记住密码选项
- **页面底部**：版权信息和技术支持信息

#### 2.1.2 登录表单字段
**账号输入框**
- 字段名称：账号
- 输入类型：文本输入框
- 占位符文本：请输入账号
- 验证规则：
  - 必填项，不能为空
  - 长度限制：3-50个字符
  - 支持字母、数字、下划线组合
- 错误提示：
  - 空值提示："请输入账号"
  - 格式错误："账号格式不正确，请输入3-50位字母、数字或下划线"

**密码输入框**
- 字段名称：密码
- 输入类型：密码输入框（隐藏显示）
- 占位符文本：请输入密码
- 功能特性：
  - 支持显示/隐藏密码切换按钮
  - 支持键盘Enter键快捷登录
- 验证规则：
  - 必填项，不能为空
  - 长度限制：6-20个字符
- 错误提示：
  - 空值提示："请输入密码"
  - 长度错误："密码长度应为6-20个字符"

#### 2.1.3 登录操作流程
1. **用户输入验证**
   - 实时验证账号格式
   - 检查必填字段完整性
   - 前端表单验证通过后启用登录按钮

2. **登录请求处理**
   - 点击登录按钮触发登录请求
   - 显示加载状态，按钮文字变为"登录中..."
   - 禁用表单输入，防止重复提交

3. **服务端验证**
   - 验证账号是否存在
   - 验证密码是否正确
   - 检查账号状态（是否被禁用、锁定等）
   - 记录登录日志

4. **登录结果处理**
   - **登录成功**：
     - 生成用户会话token
     - 记录登录时间和IP地址
     - 跳转到数据看板首页
     - 显示欢迎信息
   - **登录失败**：
     - 显示具体错误信息
     - 清空密码输入框
     - 记录失败尝试次数
     - 连续失败5次后锁定账号30分钟

#### 2.1.4 安全机制
**密码安全**
- 密码传输采用HTTPS加密
- 服务端密码采用加盐哈希存储
- 支持密码强度检测

**登录安全**
- 登录失败次数限制（5次）
- 账号临时锁定机制（30分钟）
- IP地址白名单控制（可选）
- 登录日志记录和监控

**会话管理**
- Token有效期设置（8小时）
- 支持单点登录控制
- 自动续期机制
- 安全退出功能

### 2.2 忘记密码模块

#### 2.2.1 忘记密码页面布局
- **页面标题**：密码重置
- **重置表单区域**：分步骤显示重置流程
- **返回登录链接**：方便用户返回登录页面
- **进度指示器**：显示当前重置步骤

#### 2.2.2 密码重置流程

**步骤1：输入账号**
- 字段名称：账号
- 输入类型：文本输入框
- 占位符文本：请输入需要重置密码的账号
- 验证规则：
  - 必填项，不能为空
  - 账号格式验证
  - 检查账号是否存在
- 错误提示：
  - "请输入账号"
  - "账号不存在，请检查后重新输入"

**步骤2：获取验证码**
- 验证码发送方式：短信验证码（优先）或邮箱验证码
- 发送逻辑：
  - 根据账号绑定的手机号或邮箱发送
  - 验证码为6位数字
  - 有效期5分钟
  - 支持重新发送（60秒间隔）
- 显示信息：
  - "验证码已发送至您的手机 138****1234"
  - "验证码已发送至您的邮箱 user****@example.com"

**步骤3：输入验证码**
- 字段名称：验证码
- 输入类型：数字输入框
- 占位符文本：请输入6位验证码
- 功能特性：
  - 自动聚焦
  - 支持粘贴功能
  - 倒计时显示
- 验证规则：
  - 必填项，6位数字
  - 验证码正确性校验
  - 验证码有效期校验
- 错误提示：
  - "请输入验证码"
  - "验证码格式错误，请输入6位数字"
  - "验证码错误，请重新输入"
  - "验证码已过期，请重新获取"

**步骤4：设置新密码**
- **新密码输入框**
  - 字段名称：新密码
  - 输入类型：密码输入框
  - 占位符文本：请输入新密码
  - 验证规则：
    - 必填项，不能为空
    - 长度：8-20个字符
    - 必须包含字母和数字
    - 不能与原密码相同
  - 密码强度指示器：弱/中/强

- **确认密码输入框**
  - 字段名称：确认密码
  - 输入类型：密码输入框
  - 占位符文本：请再次输入新密码
  - 验证规则：
    - 必填项，不能为空
    - 必须与新密码一致
  - 错误提示：
    - "请确认密码"
    - "两次输入的密码不一致"

**步骤5：重置成功**
- 成功页面显示：
  - 成功图标
  - "密码重置成功"提示信息
  - "您的密码已成功重置，请使用新密码登录"
  - 自动跳转倒计时（5秒）
  - "立即登录"按钮

#### 2.2.3 安全控制
**验证码安全**
- 验证码随机生成，不可预测
- 单次使用，验证后立即失效
- 发送频率限制（同一账号1分钟内最多3次）
- 验证失败次数限制（连续5次失败后锁定账号）

**重置安全**
- 重置操作日志记录
- IP地址记录和监控
- 异常重置行为告警
- 重置成功后强制重新登录

## 3. 用户交互设计

### 3.1 页面响应式设计
- 支持桌面端（1920x1080及以上）
- 支持平板端（768px-1024px）
- 支持移动端（320px-767px）
- 自适应布局，确保各设备良好体验

### 3.2 交互反馈
**加载状态**
- 登录按钮加载动画
- 验证码发送加载状态
- 页面跳转过渡动画

**错误提示**
- 实时表单验证提示
- 错误信息红色高亮显示
- 成功操作绿色提示

**用户引导**
- 首次使用引导说明
- 操作步骤清晰指示
- 帮助文档链接

### 3.3 无障碍设计
- 支持键盘导航
- 屏幕阅读器兼容
- 高对比度模式支持
- 字体大小可调节

## 4. 数据结构设计

### 4.1 用户账号数据
```
用户表 (users)
- id: 用户唯一标识
- username: 账号名称
- password_hash: 密码哈希值
- salt: 密码盐值
- phone: 绑定手机号
- email: 绑定邮箱
- status: 账号状态 (active/disabled/locked)
- department_id: 所属部门ID
- role_id: 角色ID
- last_login_time: 最后登录时间
- last_login_ip: 最后登录IP
- failed_login_count: 登录失败次数
- locked_until: 锁定截止时间
- created_at: 创建时间
- updated_at: 更新时间
```

### 4.2 登录日志数据
```
登录日志表 (login_logs)
- id: 日志唯一标识
- user_id: 用户ID
- username: 登录账号
- login_time: 登录时间
- login_ip: 登录IP地址
- user_agent: 浏览器信息
- login_result: 登录结果 (success/failed)
- failure_reason: 失败原因
- session_token: 会话token
- logout_time: 退出时间
```

### 4.3 验证码数据
```
验证码表 (verification_codes)
- id: 验证码唯一标识
- user_id: 用户ID
- code: 验证码
- type: 验证码类型 (password_reset/login)
- send_method: 发送方式 (sms/email)
- send_target: 发送目标（手机号或邮箱）
- created_at: 创建时间
- expires_at: 过期时间
- used_at: 使用时间
- status: 状态 (pending/used/expired)
```

## 5. 业务规则

### 5.1 账号管理规则
- 账号名称全局唯一
- 支持手机号和邮箱绑定
- 账号状态控制访问权限
- 支持批量账号管理

### 5.2 密码策略
- 密码复杂度要求：8-20位，包含字母和数字
- 密码有效期：90天（可配置）
- 密码历史记录：不能重复使用最近5次密码
- 首次登录强制修改密码

### 5.3 会话管理规则
- 会话超时时间：8小时无操作自动退出
- 支持单点登录：同一账号同时只能在一处登录
- 会话续期：用户操作时自动延长会话时间
- 安全退出：清除所有会话信息

## 6. 异常处理

### 6.1 网络异常
- 网络连接超时处理
- 服务器错误友好提示
- 自动重试机制
- 离线状态检测

### 6.2 系统异常
- 数据库连接异常
- 服务不可用处理
- 系统维护提示
- 错误日志记录

### 6.3 用户操作异常
- 非法输入过滤
- 恶意攻击防护
- 频繁操作限制
- 异常行为监控

## 7. 性能要求

### 7.1 响应时间
- 登录验证响应时间 < 2秒
- 验证码发送时间 < 5秒
- 页面加载时间 < 3秒
- 密码重置完成时间 < 10秒

### 7.2 并发处理
- 支持1000并发用户登录
- 数据库连接池优化
- 缓存机制提升性能
- 负载均衡支持

### 7.3 可用性
- 系统可用性 > 99.9%
- 故障恢复时间 < 5分钟
- 数据备份和恢复
- 灾难恢复预案

## 8. 测试用例

### 8.1 登录功能测试
- 正确账号密码登录成功
- 错误账号或密码登录失败
- 空账号或密码提示错误
- 账号被锁定无法登录
- 会话超时自动退出

### 8.2 密码重置测试
- 正确账号获取验证码成功
- 不存在账号无法获取验证码
- 正确验证码验证成功
- 错误或过期验证码验证失败
- 新密码设置成功并可正常登录

### 8.3 安全性测试
- SQL注入攻击防护
- XSS攻击防护
- 暴力破解防护
- 会话劫持防护
- 密码传输加密



## 10. 角色权限设计

### 10.1 用户角色定义
- **超级管理员**：系统最高权限，可管理所有功能和用户
- **部门管理员**：管理本部门用户和数据
- **销售总监**：查看销售相关数据和报表
- **销售经理**：管理销售团队和客户
- **销售人员**：查看分配的客户数据
- **运营总监**：查看运营相关数据和报表
- **优化师**：管理广告账户和优化数据
- **财务人员**：查看财务相关数据

### 10.2 权限控制规则
- 基于角色的访问控制（RBAC）
- 数据权限按部门和层级控制
- 功能权限按角色分配
- 支持权限继承和覆盖

### 10.3 登录后权限验证
- 登录成功后获取用户角色信息
- 根据角色控制菜单显示
- 页面访问权限实时验证
- API接口权限校验

## 11. 用户体验优化

### 11.1 登录便利性
- 记住账号功能
- 自动填充上次登录账号
- 支持Tab键切换输入框
- Enter键快捷登录

### 11.2 错误处理优化
- 友好的错误提示信息
- 错误原因明确指导
- 提供解决方案建议
- 客服联系方式


